<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>cDeploy</title>
    <META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="http://craydent.com/JsonObjectEditor/capp.css"/>
    <link rel="stylesheet" href="/JsonObjectEditor/capp.css"/>
    <script src=":4900/socket.io/socket.io.js"></script>
    <!--<script src="http://localhost:4900/socket.io/socket.io.js"></script>-->
<!--    <script src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
    <script src="http://craydent.com/resources/library/craydent-1.8.0.js"></script>-->
    <script src="http://craydent.com/JsonObjectEditor/_joecraydent.js"></script>
    <script src="http://craydent.com/JsonObjectEditor/capp.js"></script>
    <script src="/JsonObjectEditor/capp.js"></script>

    <script>
        var appStrs = {
            tail:'',
            tail_error:'',
            process_complete:''
        };
        var socket = io($l.protocol + "//" + $l.hostname + ':4900');
        function printTo(print,to){
            var d = $c.format(new Date(),'m/d/y h:i:s');
            document.getElementById(to).innerHTML += '<small>'+d+'</small> '+print;
            appStrs[to] += print;
            //goJoe(appStrs[to]);
        }
//        var socket = io('http://localhost:4900');
        socket.on('line', function (data) {
            var m =  data.file + ":"+data.line + "<br />";
            printTo(m,'tail');
        });
        socket.on('error', function (data) {
            var m =  data.file + ":"+data.line + "<br />";
            document.getElementById("tail_error").innerHTML += data + "<br />";
            printTo(m,'tail');
        });
        socket.on('process_complete', function (data) {
            var m =  data.file + ":"+data.line + "<br />";
            document.getElementById("out").innerHTML += data.output.replace(/\n/g,'<br />') + '<br /><br />';
            printTo(m,'tail');
        });
        function reload_config() {
            $.ajax({
                url:"http://deploy.craydent.com/RELOAD_CONFIG",
                dataType:"json",
                success:function(data){
                    console.log(data);
                    alert(data.message);
                }
            });
        }
    </script>
    <style>
       .output_window {
            position:absolute;
            top:40px;
            left:0;
            bottom:0;
            right:0;
            display:none;
            overflow:auto;
        }
        .output_window.active{
            display: block;
        }
        .apps {
            width: 150px;
            float: left;
        }
        .apps div {
            cursor: pointer;
            margin:10px;
        }

        #appOutputs{
            position: absolute;
            right: 10px;
            top: 10px;
            left: 60px;
            bottom: 10px;
            border: 1px solid #fff;
            padding:50px 10px 0 10px;
            overflow:auto;
            color:#eee;
            /* margin: 5px; */

        }

        outputsMenu{
            display:block;
            background:rgba(255,255,255,.2);
            position:absolute;
            top:0;
            left:0;
            right:0;
        }

        outputName{
            width:33%;
            width:calc(100%/3);
            float:left;
            box-sizing: border-box;
            padding:10px;
            cursor:pointer;
            transition:.2s;
        }
        outputName.active{
            background:rgba(255,255,255,.2);
            cursor:auto;
        }
       capp-submenu {
           position: absolute;
           display: none;
       }
       capp-submenu.active {
           display: block;
       }
    </style>
    <script>
        function callServerAction(socketaction,dom,action) {
            var name = dom.getAttribute('data-appname');
            if (confirm('Are you sure you want to '+socketaction+' \n'+name)) {
                /*socket.emit('deploy',{passcode:window.location.search.substring(1),name:this.innerText,action:'build'});*/
                socket.emit(socketaction, {
                    passcode: window.location.search.substring(1),
                    name: name,
                    action: action || null
                });
            }
        }
        $(function(){
            $('outputName').click(function(){
                var index = $(this).index();
                $('outputName,.output_window').removeClass('active');
                $('outputName,.output_window').eq(index).addClass('active');
                $('.output_window').eq(index).addClass('active');
            });
            var capp = new CraydentApp({
                autoInit:true
            });
        });
        function showSubmenu(dom) {
            $('capp-submenu').addClass('active');
            $('capp-submenu').attr('data-appname',dom.innerHTML);
            $('capp-submenu')[0].style.top = (dom.top() - dom.height()) + "px";
            $('capp-submenu')[0].style.left = (dom.left() + dom.width()) + "px";
        }
        function hideSubmenu(dom) {
            $('capp-submenu').removeClass('active');
            $('capp-submenu').attr('data-app','');
        }
    </script>
</head>
<body bgcolor="#0099aa">
<capp-wrapper>


    <capp-header class="capp-retro">
        <capp-header-bonus ></capp-header-bonus>
        <capp-craydent-icon></capp-craydent-icon>
        <capp-title>Deploy</capp-title>
    </capp-header>
    <capp-body>
        <capp-panel class="capp-bg-dark">
            <capp-button  class="capp-panel-toggle">
                <capp-button-icon><-></capp-button-icon>
                <capp-button-label>expand / contract</capp-button-label>
            </capp-button>
            <capp-menu>
                <capp-menu-label>
                    <capp-button-icon>Apps</capp-button-icon>
                    <capp-button-label>Deployable Apps</capp-button-label>

                </capp-menu-label>
                <capp-menu-option onmouseover="showSubmenu(this);" onmouseout="hideSubmenu(this);">catnap</capp-menu-option>
                <capp-menu-option onmouseover="showSubmenu(this);" onmouseout="hideSubmenu(this);">deploy</capp-menu-option>
                <capp-menu-option onmouseover="showSubmenu(this);" onmouseout="hideSubmenu(this);">proto</capp-menu-option>
                <capp-menu-option onmouseover="showSubmenu(this);" onmouseout="hideSubmenu(this);">proxy</capp-menu-option>
                <capp-menu-option onmouseover="showSubmenu(this);" onmouseout="hideSubmenu(this);">shapow</capp-menu-option>
                <capp-menu-option onmouseover="showSubmenu(this);" onmouseout="hideSubmenu(this);">joe</capp-menu-option>
            </capp-menu>

            <capp-submenu>
                <capp-submenu-option onclick="callServerAction('deploy',this,'backup')">backup</capp-submenu-option>
                <capp-submenu-option onclick="callServerAction('deploy',this,'build')">build</capp-submenu-option>
                <capp-submenu-option onclick="callServerAction('deploy',this,'npminstall')">npminstall</capp-submenu-option>
                <capp-submenu-option onclick="callServerAction('deploy',this,'pull')">pull</capp-submenu-option>
                <capp-submenu-option onclick="callServerAction('deploy',this,'pullrestart')">pullrestart</capp-submenu-option>
                <capp-submenu-option onclick="callServerAction('deploy',this,'pullsync')">pullsync</capp-submenu-option>
                <capp-submenu-option onclick="callServerAction('deploy',this,'restart')">restart</capp-submenu-option>
                <capp-submenu-option onclick="callServerAction('deploy',this,'start')">start</capp-submenu-option>
                <capp-submenu-option onclick="callServerAction('deploy',this,'stop')">stop</capp-submenu-option>
                <capp-submenu-option onclick="callServerAction('deploy',this,'sync')">sync</capp-submenu-option>
            </capp-submenu>

<!--            <appMenuLabel>Logs</appMenuLabel>
            <capp-button onclick="callServerAction('tail',this)">catnap</capp-button>
            <capp-button onclick="callServerAction('tail',this)">deploy</capp-button>
            <capp-button onclick="callServerAction('tail',this)">proto</capp-button>
            <capp-button onclick="callServerAction('tail',this)">proxy</capp-button>
            <capp-button onclick="callServerAction('tail',this)">shapow</capp-button>-->
            <capp-button  onclick="reload_config();">
                <capp-button-icon><img src="http://craydent.com/JsonObjectEditor/img/svgs/__reload.svg" class="svg"/></capp-button-icon>
                <capp-button-label>Reload Proxy Config</capp-button-label>
            </capp-button>
        </capp-panel>
        <capp-view id="appOutputs">
                <outputsMenu>

                    <outputName class="active">Tail</outputName>
                    <outputName>Errors</outputName>
                    <outputName>STD Out</outputName>

                </outputsMenu>

                <div id="tail" class="output_window active"></div>
                <div id="tail_error" class="output_window">Errors:<br /></div>
                <div id="out" class="output_window">STD Out:<br /></div>
        </capp-view>

    </capp-body>
    <appMenu>
<!--        <appMenuLabel>Apps</appMenuLabel>
        <capp-button onclick="callServerAction('deploy',this,'build')">catnap</capp-button>
        <capp-button onclick="callServerAction('deploy',this,'build')">deploy</capp-button>
        <capp-button onclick="callServerAction('deploy',this,'pullsync')">proto</capp-button>
        <capp-button onclick="callServerAction('deploy',this,'pullrestart')">proxy</capp-button>
        <capp-button onclick="callServerAction('deploy',this,'build')">shapow</capp-button>
        <capp-button onclick="callServerAction('deploy',this,'pullsync')">joe</capp-button>-->

<!--        <div onclick="socket.emit('deploy',{passcode:window.location.search.substring(1),name:this.innerText,action:'build'});">
            deploy
        </div>
        <div onclick="socket.emit('deploy',{passcode:window.location.search.substring(1),name:this.innerText,action:'pullsync'});">
            proto
        </div>
        <div onclick="socket.emit('deploy',{passcode:window.location.search.substring(1),name:this.innerText,action:'pullrestart'});">
            proxy
        </div>
        <div onclick="socket.emit('deploy',{passcode:window.location.search.substring(1),name:this.innerText,action:'build'});">
            shapow
        </div>-->
<!--
        <appMenuLabel>Logs</appMenuLabel>
        <capp-button onclick="callServerAction('tail',this)">catnap</capp-button>
        <capp-button onclick="callServerAction('tail',this)">deploy</capp-button>
        <capp-button onclick="callServerAction('tail',this)">proto</capp-button>
        <capp-button onclick="callServerAction('tail',this)">proxy</capp-button>
        <capp-button onclick="callServerAction('tail',this)">shapow</capp-button>-->

      <!--  <div onclick="socket.emit('tail',{passcode:window.location.search.substring(1),name:this.innerText,action:'build'});">
            catnap
        </div>
        <div onclick="socket.emit('tail',{passcode:window.location.search.substring(1),name:this.innerText,action:'build'});">
            deploy
        </div>
        <div onclick="socket.emit('tail',{passcode:window.location.search.substring(1),name:this.innerText,action:'pullsync'});">
            proto
        </div>
        <div onclick="socket.emit('tail',{passcode:window.location.search.substring(1),name:this.innerText,action:'pullrestart'});">
            proxy
        </div>
        <div onclick="socket.emit('tail',{passcode:window.location.search.substring(1),name:this.innerText,action:'build'});">
            shapow
        </div>-->
<!--        <div onclick="reload_config();" style="margin-top: 40px;">
            Reload Proxy Config
        </div>-->
    </appMenu>


</capp-wrapper>
</body>
</html>